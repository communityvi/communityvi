<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Communityvi demo client</title>
</head>
<body>
	<h1>Communityvi demo client</h1>
	<div>
		<input type="text" name="name" id="name">
		<button id="register" onclick="registerClient()">Register</button>
		<p><b id="client_id"></b></p>
	</div>
	<script type="application/javascript">
		'use strict';

		let webSocket = null;

		function registerClient() {
			const name = document.getElementById('name').value;
			const idField = document.getElementById('client_id');

			if (webSocket !== null) {
				webSocket.close();
			}

			webSocket = new WebSocket('ws://127.0.0.1:8000/ws');
			webSocket.onopen = function (event) {
				console.log('Socket open.', event);
				const registerMessage = {
					number: 0,
					type: 'register',
					name: name,
				};
				webSocket.send(JSON.stringify(registerMessage));
			};

			webSocket.onmessage = function (messageEvent) {
				console.log('Received message.', messageEvent);
				const messageData = messageEvent.data;
				const message = JSON.parse(messageData);
				idField.innerText = message.id;
			};

			webSocket.onclose = function (event) {
				console.log('Socket closed.', event);
			};

			webSocket.onerror = function (event) {
				console.log('Received error.', event);
			};
		}

	</script>
</body>
</html>
